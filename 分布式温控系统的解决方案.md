# 分布式温控系统的解决方案

## 目标

- 完全实现需求，使得房客可开关空调、设置空调风速与温度以及查看空调费；酒店收银员在房客退房时可提供空调账单及详单；酒店空调管理员可监控各客房空调使用情况；酒店经理可查看不同时间范围内的格式化统计报表。
- 可靠性高，能够7*24小时稳定运行。
- 系统操作界面友好，容易上手。
- 高并发，高吞吐率，低延时。

## 需求

- 本分布式温控系统分为服务器端和客户端。
- 服务器端接收各客房空调开关状态、冷热模式、风速请求与温度设定信息，进而以最低能耗控制中央空调的开关与负载，并以指定冷热模式向各客房送风，从而响应了节能绿色环保理念。其中，风速请求分为高风、中风、低风、无风四档，耗电标准为高风1度/分钟，中风0.5度/分钟，低风0.333度/分钟，无风0度/分钟，电费1元/度，制冷模式温度范围为18-25℃，制热模式温度范围为25-30℃。
- 为进一步响应绿色节能环保理念，避免冬天制冷、夏天制热这样不合理的请求，空调管理员可根据当前气温在服务器端设置制冷模式，拒绝不一致的客户端送风请求。
- 服务器端还可统计指定客房的空调账单与详单，监控各客房的使用情况，查看不同时间范围内的格式化统计报表。详单包含的信息为房间号、每次送风时房间温度，结束送风时房间温度，持续时间，耗电量，电费。
- 客户端可开关室内机，显示温度传感器发来的客房温度以及服务器发来的空调费，设定冷热模式、目标温度与风速，根据设定温度动态向服务端发送风速请求。客房温度达到目标温度（即制冷模式下客房温度≤目标温度，制热模式下客房温度≥目标温度），发送无风请求给服务端；当房间温度超过目标温度1℃时（即制冷模式下客房温度≥目标温度+1，制热模式下客房温度≤目标温度-1），发送设定模式送风请求给服务端，控制室内机发出设定风速。此外，客户端开关空调、调整空调制冷制热模式、调节目标温度、调节风速后，都会向服务端发送相应信息，且温度每秒最多调节1次，以一秒内最后发送的请求为准。

## 测试方案

- 温度传感器的测试数据构造方法为：
  - 空调开机，向设定温度变化，中风模式每分钟变化0.5℃，高风模式每分钟变化0.6℃，低风模式每分钟变化0.4℃。
  - 空调关机或待机，向初始温度变化，每分钟变化0.5℃。
- 随机生成客房空调请求，并通过查看各客房详单与账单、监控各客房空调使用状态、查看不同时间段格式化报表检查系统是否正确。

## 技术路线

* 结合现有技术条件，拟定的技术路线如下：

  ``` mermaid
  graph LR
  	A((分布式温控系统))-->B(服务器端)
  		B-->C[服务器端与客户端的通信]
  		B-->D[服务器端利用数据库保存当前各个房间空调状态]
  		B-->E[服务器端应对高并发]
  			C-->F{算法优化 模块测试}
  			D-->F
  			E-->F
  	A-->G(客户端)
  		G-->H[客户端UI]
  		G-->I[客户端账户角色权限]
  		G-->J[客户端非法输入过滤]
  			H-->K{操作逻辑优化 模块测试}
  			I-->K
  			J-->K
  	F-->L(组装)
  	K-->L[集成测试]
  	L-->M(运行与维护系统建设)
  	
  ```

  * 其中，各个模块暂定选用的技术如下表所示

    * |          |                       服务器端                        |                            客户端                            |
      | :------: | :---------------------------------------------------: | :----------------------------------------------------------: |
      | 编码语言 | 利用`django`为Web框架，采用`python`语言编码编写服务器 | 利用`vue`框架，采用经典的`html + JavaScrpit +CSS`编码方式编写浏览器式客户端 |
      | 通信方式 |                  `WebSocket + JSON`                   |                      `WebSocket + JSON`                      |
      |  数据库  |                 拟采用`MySQL`用作保存                 |   各房间空调状态读取时向服务器发起请求，修改后保存最新状态   |
      | 权限管理 |          拟分为客户、收银、管理三个账户权限           |          根据不同账户设计不同UI，登陆后开放相应权限          |

  * 

## 项目时间规划

* 结合现有技术条件，拟定的项目时间规划如下：

```mermaid
gantt
	dateFormat  YYYY-MM-DD
	title 分布式温控系统开发甘特图
	section 设计
		需求: done, designDemand, 2020-02-24, 2020-03-09
		原型: active, designPrototype, 2020-03-09, 7d
		UI设计: designUI, after designPrototype, 7d
		预留: designReserved, after designUI, 14d
	section 开发
		学习准备: done, 2020-02-24, 7d
		理解需求: crit, acitve, 2020-03-09, 7d
		设计框架: crit, developeFramework, after designPrototype, 7d
		编码: crit, developeCoding, after developeFramework, 30d
		预留: developeReserved, after developeCoding, 30d
	section 测试
		模块功能测试: testModule, after developeCoding, 7d
		组装: testAssembling, after testModule, 5d
		集成压力测试: testIntergrated, after testAssembling , 7d
		测试报告: testReport, after testIntergrated. 48h
```